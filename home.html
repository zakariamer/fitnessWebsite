<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FitAI Home</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ  FitAI Dashboard</h1>
      <p>Welcome back, <strong>{{ user["username"] }}</strong>!</p>
      <nav>
        <a href="/home" class="active">ğŸ  Home</a>
        <a href="/app">ğŸ“± App</a>
        <form style="display:inline;" method="post" action="/logout">
          <button type="submit" class="logout">ğŸšª Logout</button>
        </form>
      </nav>

      <!-- Temporary quick input menu (front-end only, remove once backend macros are live) -->
      <div id="quick-input-toggle" class="quick-input-toggle" title="Quick daily input">
        âš™ï¸
      </div>

      <div id="quick-input-panel" class="quick-input-panel">
        <h3>Quick Daily Input</h3>

        <label>
          Calories Today
          <input type="number" id="qi-cal" placeholder="e.g. 2200" />
        </label>

        <label>
          Protein (g)
          <input type="number" id="qi-protein" placeholder="e.g. 150" />
        </label>

        <label>
          Carbs (g)
          <input type="number" id="qi-carbs" placeholder="e.g. 200" />
        </label>

        <label>
          Fats (g)
          <input type="number" id="qi-fats" placeholder="e.g. 60" />
        </label>

        <div class="qi-actions">
          <button type="button" id="qi-save">Save</button>
          <button type="button" id="qi-clear" class="secondary">Clear</button>
        </div>

        <p class="qi-note">
          Front-end only. This will be removed once backend tracking is live.
        </p>
      </div>
      <!-- End temporary quick input menu -->
    </header>

    <main>
      <div class="grid">
        <div class="card">
          <h2>ğŸ”¥ Calorie Summary</h2>

          <!-- Big today calories at top -->
          <div class="cal-today-wrapper">
            <div class="cal-label">Today</div>
            <div id="cal-home-today" class="cal-value">
              {{ calories["today"] }} kcal
            </div>
          </div>

          <!-- Three macro slots underneath -->
          <div class="macro-grid">
            <div class="macro-box" data-macro="protein" data-target="150">
              <div class="macro-label">Protein</div>
              <div id="macro-home-protein" class="macro-value">0 g</div>
              <div class="macro-octa">
                <div class="macro-octa-fill"></div>
              </div>
            </div>
            <div class="macro-box" data-macro="carbs" data-target="200">
              <div class="macro-label">Carbs</div>
              <div id="macro-home-carbs" class="macro-value">0 g</div>
              <div class="macro-octa">
                <div class="macro-octa-fill"></div>
              </div>
            </div>
            <div class="macro-box" data-macro="fats" data-target="60">
              <div class="macro-label">Fats</div>
              <div id="macro-home-fats" class="macro-value">0 g</div>
              <div class="macro-octa">
                <div class="macro-octa-fill"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>ğŸ‹ï¸ Exercise Progress</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value">{{ progress["completed"] }}</div>
              <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">{{ progress["remaining"] }}</div>
              <div class="stat-label">Remaining</div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <h2>ğŸ’ª Personal Info</h2>
          <ul>
            <li><strong>Age:</strong> {{ user["age"] or "â€”" }}</li>
            <li><strong>BMI:</strong> {{ user["bmi"] or "â€”" }}</li>
            <li><strong>Goal:</strong> {{ user["goal"] or "â€”" }}</li>
          </ul>
        </div>

        <div class="card">
          <h2>ğŸŒŸ Daily Motivation</h2>
          <blockquote id="quote"></blockquote>
        </div>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // --- Daily quote ---
      const quotes = [
        "The pain you feel today will be the strength you feel tomorrow.",
        "Small steps every day lead to big results.",
        "Discipline is choosing what you want most over what you want now.",
        "Your future self is watching. Donâ€™t let them down.",
        "Success is the sum of small efforts repeated day in and day out."
      ];
      const quoteEl = document.getElementById("quote");
      if (quoteEl) {
        quoteEl.innerText = quotes[Math.floor(Math.random() * quotes.length)];
      }

      const STORAGE_KEY = "fitai_daily_macros";

      function todayDate() {
        return new Date().toISOString().slice(0, 10);
      }

      function recomputeOcta() {
        document.querySelectorAll(".macro-box").forEach((box) => {
          const target = parseFloat(box.dataset.target) || 1;
          const valueEl = box.querySelector(".macro-value");
          const fillEl = box.querySelector(".macro-octa-fill");
          if (!valueEl || !fillEl) return;
          const text = valueEl.textContent.replace(/[^\d.]/g, "");
          const current = parseFloat(text) || 0;
          const ratio = Math.max(0, Math.min(1, current / target));
          fillEl.style.setProperty("--fill", ratio);
        });
      }

      function applyMacroDisplay(data) {
        if (!data) {
          recomputeOcta();
          return;
        }

        const calEl = document.getElementById("cal-home-today");
        if (calEl && typeof data.calories === "number") {
          calEl.textContent = data.calories + " kcal";
        }

        function setMacro(id, val) {
          const el = document.getElementById(id);
          if (el && typeof val === "number") {
            el.textContent = val + " g";
          }
        }

        if (typeof data.protein === "number")
          setMacro("macro-home-protein", data.protein);
        if (typeof data.carbs === "number")
          setMacro("macro-home-carbs", data.carbs);
        if (typeof data.fats === "number")
          setMacro("macro-home-fats", data.fats);

        recomputeOcta();
      }

      function loadQuickInput() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) {
            recomputeOcta();
            return;
          }
          const parsed = JSON.parse(raw);
          if (parsed.date !== todayDate()) {
            recomputeOcta();
            return;
          }

          const cal = document.getElementById("qi-cal");
          const p = document.getElementById("qi-protein");
          const c = document.getElementById("qi-carbs");
          const f = document.getElementById("qi-fats");

          if (cal && parsed.calories != null) cal.value = parsed.calories;
          if (p && parsed.protein != null) p.value = parsed.protein;
          if (c && parsed.carbs != null) c.value = parsed.carbs;
          if (f && parsed.fats != null) f.value = parsed.fats;

          applyMacroDisplay(parsed);
        } catch (e) {
          console.error("Failed to load quick input:", e);
          recomputeOcta();
        }
      }

      const toggle = document.getElementById("quick-input-toggle");
      const panel = document.getElementById("quick-input-panel");
      const saveBtn = document.getElementById("qi-save");
      const clearBtn = document.getElementById("qi-clear");

      if (toggle && panel) {
        toggle.addEventListener("click", () => {
          panel.classList.toggle("open");
        });
      }

      if (saveBtn) {
        saveBtn.addEventListener("click", () => {
          const data = {
            date: todayDate(),
            calories: parseFloat(document.getElementById("qi-cal").value) || 0,
            protein: parseFloat(document.getElementById("qi-protein").value) || 0,
            carbs: parseFloat(document.getElementById("qi-carbs").value) || 0,
            fats: parseFloat(document.getElementById("qi-fats").value) || 0
          };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          applyMacroDisplay(data);
        });
      }

      if (clearBtn) {
        clearBtn.addEventListener("click", () => {
          localStorage.removeItem(STORAGE_KEY);
          if (panel) panel.classList.remove("open");
          ["qi-cal", "qi-protein", "qi-carbs", "qi-fats"].forEach((id) => {
            const el = document.getElementById(id);
            if (el) el.value = "";
          });
          // Reload to fall back to backend-provided values
          window.location.reload();
        });
      }

      // Initial draw
      loadQuickInput();
    });
  </script>
</body>
</html>
